# ZvonkoBot_3
ЗвонкоБот 3 - третья версия бота "ЗвонкоБот" для многократного упрощения ежедневной учебы.

# Начало работы
Чтобы запустить ЗвонкоБот, нужно сделать следующее:
   1. Скачать ZvonkoBot 3<br>
![как скачать Zb3](https://user-images.githubusercontent.com/69675212/132102290-fcf40e02-0cb3-4f00-804d-35e38cd76382.png)
   2. Распаковать содержимое архива в любое удобное место
   3. Установить Python 3.9+:
      1. Перейти на python.org
      2. Выбрать меню "Downloads"
      3. Загрузить новейшую версию
      4. Запустить установочный файл и пройти процесс установки
   4. Запустить файл <i>install_libs.bin</i>
   5. В папке files находится файл vk_settings.py. Необходимо перейти в него и заполнить данные о ключе API и ID группы. Для более подробных инструкций, перейдите в раздел <i>"Документация"</i>.
   6. Запустить файл run.py
   
* ЗвонкоБот будет работать правильно, если загрузить стабильную версию релиза ZvonkoBot 3 и Python версии >3.9

# Документация
## Заполнение vk_settings.py
### Переменная token
В эту переменную необходимо записать значение ключа API ВКонтакте, который можно получить следующим путем:
1. В сообществе, где вы являетесь администратором, перейдите во вкладку <i>"Управление"</i>
2. Перейдите в раздел <i>"Работа с API"</i>
3. Зайдите в раздел <i>"Long Poll API"</i>
4. Включите Long Poll API
5. Выберите версию API 5.122 или новее
6. Зайдите во вкладку <i>"Типы событий"</i>
7. Поставьте галочку напротив <i>"Входящее сообщение"</i>
8. Перейдите в раздел <i>"Ключи доступа"</i>
9. Нажмите на кнопку <i>"Создать ключ"</i>
10. Выберите пункты <i>"Разрешить приложению доступ к управлению сообществом"</i> и <i>"Разрешить приложению доступ к сообщениям сообщества"</i>
11. Нажмите кнопку <i>"Создать"</i>
12. Скопируйте ключ и вставьте его в переменную token. Она будет выглядеть примерно так:

```
token = "ваш ключ"
```
### Переменная group_id
В эту переменную необходимо щаписать значение группы ВКонтакте, в которой будет запущен бот. Для этого воспользуйтесь сторонними сайтами, или найдите инструкцию, как узнать ID группы ВКонтакте. Вы получите число, например -1234567890. Скопируйте и вставьте это число в значение переменной group_id.
## Сообщения
### Текстовые сообщения
Для того, чтобы отправить базовое сообщение, необходимо использовать метод класса <i>ZvonkoBot</i>
```
ZvonkoBot.msg_send(uid, msg, keyboard)
```
Этот метод можно использовать в любом файле следующим образом:
```
import core  # подключение файла, в котором находится класс ZvonkoBot
...
bot = core.ZvonkoBot()  # создание объекта bot класса ZvonkoBot (название может быть другим)
bot.msg_send(12345678, "Привет!")  # отправка сообщения "Привет!" пользователю с ID 12345678
```
* Сообщение не получится отправить, если:
  * Пользователь с ID параметром UID (ID получателя) никогда не отправлял сообщений боту
  * Пользователь заблокировал бота
  * Доступ к сообщениям ограничен ключом доступа API ВКонтакте
  * Параметр msg (сообщение) пустой
* Важно понимать, что параметр keyboard (клавиатура) не обязателен

### Сообщения с клавиатурой
Сообщения с клавиатурой отличаются только тем, что к текстовому сообщению будет прикреплена клавиатура. (см. блок <i>Клавиатуры</i>)<br>
Для того, чтобы прикрепить клавиатуру к текстовому сообщению, необходимо указать параметр keyboard (клавиатура) в методе, где отправляется текстовое сообщение
```
ZvonkoBot.msg_send(uid, msg, keyboard)
```
На примере из прошлого блока, например:
```
import core  # подключение файла, в котором находится класс ZvonkoBot
...
bot = core.ZvonkoBot()  # создание объекта bot класса ZvonkoBot (название может быть другим)
bot.msg_send(12345678, "Привет!", "Моя первая клавиатура")  # отправка сообщения "Привет!" пользователю с ID 12345678 и клавиатурой с ID "Моя первая клавиатура" (см. блок "Создание клавиатуры")
```
К текстовому сообщению "Привет!" мы добавляем клавиатуру с ID "Моя первая клавиатура", которую создали в блоке <i>"Создание клавиатуры"</i>.
* Если параметр keyboard (клавиатура) не задан, или такой клавиатуры не существует, клавиатура не будет добавлена к сообщению.
## Клавиатуры
### Структура клавиатуры
ZvonkoBot 3 предлагает свой собственный класс клавиатур.<br>
В Zb3 у каждой клавиатуры есть:
1. ID - необходим, чтобы отправить клавиатуру пользователю
2. Кнопки - хранится вся информация о кнопках клавиатуры
3. Параметр <i>"inline"</i>, (не обязательный, по умолчанию - False) отвечает за то, будет ли клавиатура встроена в сообщение. Пример обычной и inline клавиатуры ниже.
4. Параметр <i>"callback_msg"</i>, (не обязательный, по умолчанию - None) отвечает за то, какое сообщение будет отправлено с клавиатурой, если выводить её с помощью других callback кнопок.  

* Максимальный размер обычной клавиатуры - 5 кнопок (колонн) x 10 рядов, макс. 30 кнопок.
* Максимальный размер inline клавиатуры - 5 кнопок (колонн) x 6 рядов, макс. 10 кнопок.

В ZvonkoBot 3 работа с клавиатурами представлена в виде рядов. После создания клавиатуры необходимо добавить один или несколько рядов. После этого можно добавлять кнопки на эти ряды.<br>
<br>Пример клавиатуры<br>![пример клавиатуры](https://user-images.githubusercontent.com/69675212/132103155-9d1a956b-32d9-4f96-8588-6373fa7adb06.png)
<br><br>Пример inline клавиатуры (Веб-версия)<br>![image](https://user-images.githubusercontent.com/69675212/132127805-6cac608b-46cb-46ed-8ed8-9b5427801106.png)
<br><br>Пример inline клавиатуры (Мобильная версия)<br>![image](https://user-images.githubusercontent.com/69675212/132127906-e1de27b6-baab-4ca8-8bcc-0b9cfc1d557b.png)
### Создание клавиатуры
ZvonkoBot 3 упрощает создание клавиатур по сравнению с прошлыми версиями.<br>
Для того, чтобы создать клавиатуру, необходимо перейти в файл <i>keyboards.py</i>.<br>
В самом низу файла, под комментарием <i>"создание клавиатур"</i> можно создавать свои клавиатуры. Для этого, необходимо использовать следующий класс: <br>
```
Keyboard(keyboard_id, inline)
```
Параметр keyboard_id обязателен. Он необходим, чтобы позже обратиться к этой клавиатуре.<br>
Параметр inline не обязателен. По умолчанию он равен False. Этот параметр отвечает за то, будет ли клавиатура inline клавиатурой (По умолчанию - нет). Если параметр inline не указан, клавиатура будет обычной. Если указать его со значением True, клавиатура станет inline. Рассмотрим создание обычной клавиатуры с ID "Моя первая клавиатура":
```
_ = Keyboard("Моя первая клавиатура")
```
В этом примере создается переменная _ (вы можете назвать её как угодно), и к ней создается клавиатура с ID "Моя первая клавиатура".
После этого остается добавить ряды, кнопки, и завершить создание клавиатуры.
Параметр inline не указан, поэтому клавиатура - обычная. Рассмотрим создание этой же клавиатуры, только inline:
```
_ = Keyboard("Моя первая клавиатура", True)
```
В данном примере мы указали параметр inline со значением True, тем самым создали inline клавиатуру.<br><br>
Если же эта клавиатура должна меняться при взаимодействии с callback кнопками inline клавиатуры, то необходимо указать параметр <i>"callback_msg"</i>. Допустим, при нажатии на callback кнопку должна вызываться эта клавиатура с сообщением "Второе меню". Это сообщение можно обозначить так:
```
_ = Keyboard("Моя первая клавиатура", True, "Второе меню")
```
### Добавление рядов
Для того, чтобы добавить ряд в клавиатуру Zb3 необходимо использовать функцию
```
Keyboard.add_rows(rows_amount)
```
Эта функция принадлежит классу <i>Keyboard</i> и имеет параметр <i>rows_amount</i> или количество рядов. Этот параметр должен равняться натуральному числу, например 4.
<br>Рассмотрим добавление рядов на примере из прошлого блока "Создание клавиатуры":
```
_.add_rows(3)  # добавление трёх рядов в клавиатуру "_"
```
Эта строчка создаст 3 ряда в клавиатуре. Если же достаточно только одного ряда, параметр количество рядов можно не указывать. Тогда в клавиатуру добавится только один ряд
```
_.add_rows()  # добавление одного ряда в клавиатуру "_"
```
* Если параметр отрицательный, применится модуль.<br>
* Если параметр больше 10 (макс. кол-во рядов, см. <i>"Структура клавиатуры"</i>), параметр будет приравнен 10.<br>
* Если параметр равен нулю, параметр будет приравнен к 1.

### Добавление кнопок
В ZvonkoBot 3 у кнопок есть 3 параметра:
* Текст - обязательный параметр, отвечает за текст на кнопке.
* Цвет - необязательный параметр, отвечает за цвет кнопки. По умолчанию - "WHITE"
* Ряд - необязательный параметр, отвечает за ряд кнопки. По умолчанию - 1
* Callback - необязательный параметр, задает callback действие при нажатии на кнопку. Работает только на кнопки в inline клавиатурах. Также, необходимо вызвать метод ZvonkoBot.long_poll(), для того, чтобы callback кнопки работали. Синтаксис callback кнопок можно узнать в блоке ниже. По умолчанию - False.

Список цветов Zb3:
* WHITE
* BLUE
* GREEN
* RED
* Важно понимать, что на мобильной версии в темной теме цвет "BLUE" выглядит как "WHITE", а цвет "WHITE" становится серым цветом.

Чтобы добавить кнопку нужно воспользоваться функцией класса <i>Keyboard</i>
```
Keyboard.add_button(text, color, row)
```
На примере из блока <i>Создание клавиатуры</i>, добавление синей кнопки с надписью "Синяя кнопка" во 2й ряд  выглядит так:
```
_.add_button("Синяя кнопка", BLUE, 2)  # добавление синей кнопки "Синяя кнопка" во второй ряд 
```

* Важно понимать, что ряды в ZvonkoBot 3 начинаются с 1, а не с 0.
* Если параметр ряда не задан, кнопка добавится в первый ряд.
* Если ряд из параметра не существует, кнопка будет добавлена в первый ряд.
* Если рядов не существует, новый ряд будет создан.
* Если достигнут лимит кнопок (30 - для обычной, 10 - для inline клавиатур), то кнопка не будет добавлена.

### Callback кнопки: уведомления
В ZvonkoBot 3 есть функция создания callback действий на нажатии на кнопку. Работает эта функция только с кнопками в inline клавиатурах, иначе ничего не произойдет. В одной inline клавиатуре можно сделать несколько типов кнопок, как и обычные, так и callback.<br>
ZvonkoBot 3 предоставляет на выбор 2 функции callback кнопок: уведомление и переключение клавиатуры. Уведомление выглядит следующим образом:<br>
<br>Уведомление (мобильная версия)
<br>![уведомление мобильной версии](https://user-images.githubusercontent.com/69675212/132131837-985eb6b1-1b60-466b-ba5b-8f2a62196c0c.png)
<br><br>Уведомление (Веб-версия)
<br>![уведомление веб-версии](https://user-images.githubusercontent.com/69675212/132131881-328ef98b-9b33-4634-ad01-b1650e8dbc85.png)
<br><br>
Максимальная длина уведомления - 50 символов. Уведомление исчезнет автоматически, если подождать 10 секунд, либо же, если нажать на него (веб-версия), или провести по нему (мобильная версия). Чтобы добавить уведомление при нажатии на callback кнопку, необходимо задать параметр callback для кнопки, например:
```
_.add_button("Уведомление", "BLUE", 1, {
    "type": "show_snackbar",
    "text": "Уведомление. Исчезнет автоматически, или свайпом."
})
```
В этом случае мы создаем кнопку как обычно: указываем текст, цвет и ряд, но в 4-й параметр callback заполняем словарь с фигурными скобками:
* Поле "type": "show_snackbar" - указываем, что тип события - уведомление. В данном случае "show_snackbar" - обязательная константа, использование другого названия не будет работать.
* Поле "text": "..." - указываем текст, который будет указан в уведомлении. Максимальная длина сообщения: 50 символов.

### Callback кнопки: переключение клавиатуры
ZvonkoBot 3 предоставляет удобный метод переключения inline клавиатур при нажатии на callback кнопки. Для того, чтобы создать callback кнопку, при нажатии на которую клавиатура переключится на другую необходимо удостовериться, что:
* Существуют 2 inline клавиатуры, между которыми идет переключение
* Inline клавиатура, на которую будет переключаться пользователь, имеет заданный параметр callback_msg (класс Keyboard). Если этот параметр не задан, клавиатура не сможет отобразиться.
* На первой inline клавиатуре есть callback кнопка с синтаксисом на переключение на другую inline клавиатуру. (подробнее ниже)
* После объявления объекта класса ZvonkoBot запускается метод класса <i>ZvonkoBot.long_poll</i>. Если он не запускается, callback кнопки не будут работать.

Синтаксис простой callback кнопки в ZvonkoBot 3 выглядит так:
```
_.add_button("Другая клавиатура", "RED", 3, {
    "type": "zb_EXAMPLE_2"
})
```
В данном примере мы добавляем кнопку красного цвета на 3й ряд inline клавиатуры, задаем параметр callback со значением
```
{
    "type": "zb_EXAMPLE_2"
}
```
Для того, что задать callback кнопке функцию переключения на другую inline клавиатуру, в параметр callback необходимо передать значение словаря (как в примере выше), с полем "type" и значением по типу "zb_ID клавиатуры". То есть, чтобы callback кнопка переключала клавиатуры, необходимо в параметр callback передать значение словаря с полем "type", где значением является "zb_" и ID вашей клавиатуры, которое вы указывали при создании клавиатуры. Ниже указан пример создания двух inline клавиатур с callback кнопками, которые меняют клавиатуры друг на друга.
```
_ = Keyboard("EXAMPLE", True, "Первое меню")
_.add_rows(2)
_.add_button("Уведомление", "BLUE", 1, {
    "type": "show_snackbar",
    "text": "Уведомление. Исчезнет автоматически, или свайпом."
})
_.add_button("Другая клавиатура", "RED", 2, {
    "type": "zb_EXAMPLE_2"
})
_.bake()

_ = Keyboard("EXAMPLE_2", True, "Второе меню")
_.add_rows(2)
_.add_button("Обычная кнопка", "WHITE")
_.add_button("Обратно", "RED", 2, {
    "type": "zb_EXAMPLE"
})
_.bake()
```
### Завершение создания клавиатуры
Чтобы завершить создание клавиатуры, необходимо использовать функцию класса <i>Keyboard</i>
```
Keyboard.bake()
```
При использовании этого метода, все ряды и кнопки преобразуются в стандарт ВКонтакте и добавятся в список клавиатур, чтобы потом их можно было получить с помощью ID.<br>
Так выглядит эта процедура на примере из предыдущих блоков:
```
_.bake()  # завершение создания клавиатуры "_"
```
* В этот метод не надо добавлять параметр.